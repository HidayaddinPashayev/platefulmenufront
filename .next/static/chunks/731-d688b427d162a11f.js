(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[731],{9376:function(e,r,t){"use strict";var n=t(5475);t.o(n,"useParams")&&t.d(r,{useParams:function(){return n.useParams}}),t.o(n,"usePathname")&&t.d(r,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}}),t.o(n,"useSearchParams")&&t.d(r,{useSearchParams:function(){return n.useSearchParams}})},257:function(e,r,t){"use strict";var n,a;e.exports=(null==(n=t.g.process)?void 0:n.env)&&"object"==typeof(null==(a=t.g.process)?void 0:a.env)?t.g.process:t(4227)},4227:function(e){!function(){var r={229:function(e){var r,t,n,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{t="function"==typeof clearTimeout?clearTimeout:i}catch(e){t=i}}();var l=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?l=n.concat(l):u=-1,l.length&&m())}function m(){if(!c){var e=o(d);c=!0;for(var r=l.length;r;){for(n=l,l=[];++u<r;)n&&n[u].run();u=-1,r=l.length}n=null,c=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===i||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function f(e,r){this.fun=e,this.array=r}function h(){}a.nextTick=function(e){var r=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];l.push(new f(e,r)),1!==l.length||c||o(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},t={};function n(e){var a=t[e];if(void 0!==a)return a.exports;var s=t[e]={exports:{}},i=!0;try{r[e](s,s.exports,n),i=!1}finally{i&&delete t[e]}return s.exports}n.ab="//";var a=n(229);e.exports=a}()},3731:function(e,r,t){"use strict";t.d(r,{I:function(){return f}});var n=t(7437),a=t(2265),s=t(9376),i=t(8734),o=t(7648);let l=a.forwardRef(function(e,r){let{title:t,titleId:n,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},s),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}),c={ROLE_SUPERADMIN:[{label:"Dashboard",href:"/superadmin/dashboard"},{label:"Branches",href:"/superadmin/branches"},{label:"Admins",href:"/superadmin/admins"},{label:"Staff",href:"/superadmin/staff"}],ROLE_ADMIN:[{label:"Dashboard",href:"/admin/dashboard"},{label:"Staff",href:"/admin/staff"},{label:"Tables",href:"/admin/tables"},{label:"Menu",href:"/admin/menu"},{label:"Kitchen settings",href:"/admin/kitchen"}],ROLE_WAITER:[],ROLE_KITCHEN:[{label:"Orders",href:"/kitchen/orders"}]},u=function(e,r){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?e===r:e===r||e.startsWith("".concat(r,"/"))};function d(e){var r,t;let{isOpen:a,onClose:d}=e,{user:m,logout:f}=(0,i.a)(),h=(0,s.usePathname)();if(!m)return null;let p=null!==(r=c[m.role])&&void 0!==r?r:[];return(0,n.jsxs)(n.Fragment,{children:[a&&(0,n.jsx)("div",{className:"fixed inset-0 z-20 bg-black/50 backdrop-blur-sm md:hidden",onClick:d}),(0,n.jsxs)("aside",{className:"\n          fixed top-0 left-0 z-30 h-screen w-72 flex-col bg-white border-r border-warm-200 transition-transform duration-300 ease-in-out\n          md:translate-x-0 md:static\n          ".concat(a?"translate-x-0":"-translate-x-full","\n        "),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-warm-100",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-wide text-warm-400 font-bold",children:"Signed in as"}),(0,n.jsx)("p",{className:"mt-1 text-lg font-bold text-warm-900 truncate max-w-[200px]",title:m.email,children:m.email}),(0,n.jsx)("p",{className:"text-sm capitalize text-warm-500",children:m.role.replace("ROLE_","").toLowerCase()})]}),(0,n.jsx)("button",{onClick:d,className:"md:hidden p-2 text-warm-500 hover:bg-warm-100 rounded-lg",children:(0,n.jsx)(l,{className:"w-6 h-6"})})]}),(0,n.jsx)("div",{className:"px-6 py-2",children:(0,n.jsxs)("p",{className:"text-xs text-warm-400 font-medium",children:[null!==(t=m.restaurantName)&&void 0!==t?t:"Restaurant #".concat(m.restaurantId),m.branchId?" â€¢ Branch #".concat(m.branchId):""]})}),(0,n.jsx)("nav",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-1",children:p.map(e=>{let r=u(h,e.href,e.exact);return(0,n.jsx)(o.default,{href:e.href,onClick:()=>d(),className:"\n                  flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200\n                  ".concat(r?"bg-primary-50 text-primary-700 shadow-sm":"text-warm-600 hover:bg-warm-50 hover:text-warm-900","\n                "),children:e.label},e.href)})}),(0,n.jsx)("div",{className:"p-4 border-t border-warm-100",children:(0,n.jsx)("button",{type:"button",onClick:()=>f(),className:"w-full flex items-center justify-center gap-2 rounded-xl border border-warm-200 px-4 py-2.5 text-sm font-semibold text-warm-700 transition-all hover:bg-warm-50 hover:text-red-600 hover:border-red-200 active:scale-95",children:"Sign out"})})]})]})}let m=a.forwardRef(function(e,r){let{title:t,titleId:n,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":n},s),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))});function f(e){let{allowedRoles:r,children:t}=e,o=(0,s.useRouter)(),{user:l,loading:c}=(0,i.a)(),[u,f]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if(!c){if(!l){o.replace("/login");return}r.includes(l.role)||o.replace("/login")}},[r,c,o,l]),c||!l)?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-warm-50",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,n.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-primary-200 border-t-primary-600"}),(0,n.jsx)("div",{className:"text-sm font-medium text-warm-600",children:"Checking session..."})]})}):r.includes(l.role)?(0,n.jsxs)("div",{className:"flex min-h-screen bg-warm-50",children:[(0,n.jsx)(d,{isOpen:u,onClose:()=>f(!1)}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 transition-all duration-300",children:[(0,n.jsxs)("header",{className:"md:hidden flex items-center justify-between bg-white border-b border-warm-200 px-4 py-3 sticky top-0 z-20",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("button",{onClick:()=>f(!0),className:"p-2 -ml-2 text-warm-600 hover:bg-warm-100 rounded-lg transition-colors",children:(0,n.jsx)(m,{className:"w-6 h-6"})}),(0,n.jsx)("span",{className:"font-bold text-warm-900",children:"Cozy Corner"})]}),(0,n.jsx)("div",{className:"h-8 w-8 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-bold text-xs",children:l.email.charAt(0).toUpperCase()})]}),(0,n.jsx)("main",{className:"flex-1 overflow-y-auto p-4 md:p-8",children:(0,n.jsx)("div",{className:"mx-auto max-w-7xl",children:t})})]})]}):null}},8734:function(e,r,t){"use strict";t.d(r,{a:function(){return a}});var n=t(3896);let a=()=>(0,n.E)()},533:function(e,r,t){"use strict";t.d(r,{CT:function(){return s},eg:function(){return o},NA:function(){return i}});var n,a=t(257);let s="http://localhost:8080/api".replace(/\/+$/,"")||(null===(n=a.env.NEXT_PUBLIC_API_URL)||void 0===n?void 0:n.replace(/\/+$/,""))||"http://localhost:8080/api",i=!0,o={ROLE_SUPERADMIN:"/superadmin/dashboard",ROLE_ADMIN:"/admin/dashboard",ROLE_WAITER:"/login",ROLE_KITCHEN:"/login"}},3896:function(e,r,t){"use strict";t.d(r,{E:function(){return u},H:function(){return c}});var n=t(7437),a=t(2265),s=t(9376),i=t(533);let o=(0,a.createContext)(void 0),l=e=>{var r;return null!==(r=i.eg[e])&&void 0!==r?r:"/admin/dashboard"};function c(e){let{children:r}=e,t=(0,s.useRouter)(),[i,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[m,f]=(0,a.useState)(!0),h=(0,a.useCallback)(e=>{if(!e||!e.user||!e.token||"ROLE_WAITER"===e.user.role){c(null),d(null);return}c({...e.user,permissions:Array.isArray(e.user.permissions)?e.user.permissions:[]}),d(e.token)},[]),p=(0,a.useCallback)(async()=>{try{f(!0);let e=await fetch("/api/auth/session",{cache:"no-store"});if(!e.ok)throw Error("Failed to fetch session");let r=await e.json();h(r)}catch(e){console.error("[Auth] session error",e),c(null),d(null)}finally{f(!1)}},[h]);(0,a.useEffect)(()=>{p()},[p]);let x=(0,a.useCallback)(async e=>{var r,n;let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(403===a.status){let e=await a.json();throw Error(null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"Login restricted for this role")}if(!a.ok){let e=await a.json().catch(()=>void 0);throw Error(null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Login failed")}let s=await a.json();if(!s.user||!s.token)throw Error("Invalid login response");if("ROLE_WAITER"===s.user.role)throw Error("Login not permitted for this role.");return h(s),t.replace(l(s.user.role)),s.user},[h,t]),b=(0,a.useCallback)(async()=>{await fetch("/api/auth/logout",{method:"POST"}),c(null),d(null),t.replace("/login")},[t]),v=(0,a.useMemo)(()=>({user:i,token:u,loading:m,login:x,logout:b,refreshSession:p}),[i,u,m,x,b,p]);return(0,n.jsx)(o.Provider,{value:v,children:r})}let u=()=>{let e=(0,a.useContext)(o);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}}}]);