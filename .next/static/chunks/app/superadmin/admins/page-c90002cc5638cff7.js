(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[410],{8805:function(e,s,n){Promise.resolve().then(n.bind(n,7986))},7986:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return u}});var r=n(7437),a=n(2265),t=n(8734),l=n(2285),i=n(620);let o={admins:[],branches:[],loading:!0,error:null},d={email:"",password:"",branchId:""},c={password:""};function u(){var e;let{user:s}=(0,t.a)(),n=(0,l.h)(),[u,b]=(0,a.useState)(o),[p,h]=(0,a.useState)(!1),[x,f]=(0,a.useState)(d),[g,v]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null),[N,j]=(0,a.useState)(c),[A,I]=(0,a.useState)(!1),[C,S]=(0,a.useState)(null),[E,k]=(0,a.useState)(""),[U,M]=(0,a.useState)(!1),R=null!==(e=null==s?void 0:s.restaurantId)&&void 0!==e?e:null;(0,a.useEffect)(()=>{let e=!1,r=async()=>{if(!R){b({admins:[],branches:[],loading:!1,error:"Restaurant assignment missing in JWT."});return}b(e=>({...e,loading:!0,error:null}));try{let[s,r]=await Promise.all([(0,i.zu)(n,R),(0,i.Pz)(n,R)]);if(e)return;b({admins:s,branches:r,loading:!1,error:null})}catch(s){if(console.error("[SuperadminAdmins] load error",s),e)return;b({admins:[],branches:[],loading:!1,error:"Failed to load admins."})}};return(null==s?void 0:s.role)==="ROLE_SUPERADMIN"?r():b(o),()=>{e=!0}},[n,R,s]);let L=(0,a.useMemo)(()=>{let e=new Map;return u.branches.forEach(s=>e.set(s.id,s)),e},[u.branches]),_=()=>f(d),D=()=>{y(null),j(c)},F=()=>{S(null),k("")},P=async e=>{if(e.preventDefault(),R){v(!0),b(e=>({...e,error:null}));try{let e=x.email.trim().toLowerCase(),s=x.password.trim();if(!e||!s)throw Error("Email and password are required.");let r=x.branchId?Number(x.branchId):void 0,a=await (0,i.uV)(n,R,{email:e,password:s,branchId:r});b(e=>({...e,admins:[a,...e.admins]})),_(),h(!1)}catch(e){console.error("[SuperadminAdmins] create error",e),b(s=>({...s,error:e instanceof Error?e.message:"Failed to create admin."}))}finally{v(!1)}}},O=e=>{y(e.email),j(c)},B=async e=>{if(e.preventDefault(),w){I(!0),b(e=>({...e,error:null}));try{let e=N.password.trim();if(!e)throw Error("Enter a new password to update this admin.");let s=u.admins.find(e=>e.email===w);if(!s)throw Error("Admin not found.");await (0,i.RZ)(n,s.id,e),b(e=>({...e,admins:e.admins.map(e=>e.email===w?{...e}:e)})),D()}catch(e){console.error("[SuperadminAdmins] password reset error",e),b(s=>({...s,error:e instanceof Error?e.message:"Failed to reset admin password."}))}finally{I(!1)}}},q=async e=>{if(confirm("Delete this admin? They will lose access immediately.")){b(e=>({...e,error:null}));try{await (0,i.jP)(n,e),b(s=>({...s,admins:s.admins.filter(s=>s.email!==e)})),w===e&&D(),(null==C?void 0:C.email)===e&&F()}catch(e){console.error("[SuperadminAdmins] delete error",e),b(e=>({...e,error:"Failed to delete admin."}))}}},T=e=>{S(e),k(e.branchId?String(e.branchId):"")},z=async e=>{if(e.preventDefault(),C){if("unassign"===E){var s,r,a,t,l,o,d,c,u,m,p,h;M(!0),b(e=>({...e,error:null}));try{if(console.log("[SuperadminAdmins] Attempting to unassign admin:",{email:C.email,currentBranchId:C.branchId}),C.branchId){let e=L.get(C.branchId);if(e){console.log("[SuperadminAdmins] Also updating branch to remove adminUserId:",e.id);try{await (0,i.o_)(n,e.id,{adminUserId:null}),console.log("[SuperadminAdmins] Branch updated successfully")}catch(e){console.warn("[SuperadminAdmins] Failed to update branch, continuing with user update:",e)}}}try{let{data:e}=await n.put("/superadmin/users/".concat(encodeURIComponent(C.email.toLowerCase())),{branchId:null});console.log("[SuperadminAdmins] Unassign response (superadmin endpoint):",e),b(e=>({...e,admins:e.admins.map(e=>e.email===C.email?{...e,branchId:null}:e)})),F();return}catch(e){console.warn("[SuperadminAdmins] Superadmin endpoint failed, trying general endpoint:",{message:null==e?void 0:e.message,response:null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.data,status:null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.status});try{await (0,i.aq)(n,C.email,{branchId:null}),console.log("[SuperadminAdmins] Unassign successful via general endpoint")}catch(e){throw console.error("[SuperadminAdmins] General endpoint also failed:",{message:null==e?void 0:e.message,response:null==e?void 0:null===(a=e.response)||void 0===a?void 0:a.data,status:null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status}),e}b(e=>({...e,admins:e.admins.map(e=>e.email===C.email?{...e,branchId:null}:e)})),F()}}catch(s){console.error("[SuperadminAdmins] unassign error",s),console.error("[SuperadminAdmins] Full error details:",{message:null==s?void 0:s.message,response:null==s?void 0:null===(l=s.response)||void 0===l?void 0:l.data,status:null==s?void 0:null===(o=s.response)||void 0===o?void 0:o.status,statusText:null==s?void 0:null===(d=s.response)||void 0===d?void 0:d.statusText});let e="Failed to unassign branch.";(null==s?void 0:null===(u=s.response)||void 0===u?void 0:null===(c=u.data)||void 0===c?void 0:c.message)?e=s.response.data.message:(null==s?void 0:null===(p=s.response)||void 0===p?void 0:null===(m=p.data)||void 0===m?void 0:m.error)?e=s.response.data.error:(null==s?void 0:s.message)&&(e=s.message),(null==s?void 0:null===(h=s.response)||void 0===h?void 0:h.status)&&(e+=" (Status: ".concat(s.response.status,")")),b(s=>({...s,error:e}))}finally{M(!1)}return}if(E){M(!0),b(e=>({...e,error:null}));try{await (0,i.$6)(n,Number(E),C.id);let e=Number(E);b(s=>({...s,admins:s.admins.map(s=>s.email===C.email?{...s,branchId:e}:s)})),F()}catch(e){console.error("[SuperadminAdmins] assign error",e),b(e=>({...e,error:"Failed to assign branch."}))}finally{M(!1)}}}};return(null==s?void 0:s.role)!=="ROLE_SUPERADMIN"?(0,r.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-6 py-4 text-sm text-amber-900",children:"Access restricted to SuperAdmin role."}):R?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("header",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Admins"}),(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"Manage administrator accounts assigned to each branch of your restaurant."})]}),(0,r.jsx)("button",{type:"button",className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700",onClick:()=>{_(),h(!0)},children:"+ Create admin"})]}),u.error?(0,r.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:u.error}):null,u.loading?(0,r.jsx)("div",{className:"rounded-lg border border-slate-200 bg-white px-4 py-3 text-sm text-slate-500",children:"Loading admins…"}):0===u.admins.length?(0,r.jsx)("div",{className:"rounded-lg border border-dashed border-slate-300 bg-white px-4 py-6 text-center text-sm text-slate-500",children:"No admins found. Create the first branch admin to get started."}):(0,r.jsx)("div",{className:"space-y-3",children:u.admins.map(e=>{let s=e.branchId?L.get(e.branchId):null;return(0,r.jsx)("article",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:e.email}),(0,r.jsxs)("div",{className:"mt-1 text-xs text-slate-500",children:["Admin ID: ",e.id]}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-slate-600",children:["Assigned branch: ",(0,r.jsx)("span",{className:"font-medium text-slate-900",children:s?s.name:"Unassigned"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-stretch gap-2 text-xs font-medium text-slate-600 sm:flex-row",children:[(0,r.jsx)("button",{type:"button",onClick:()=>T(e),className:"inline-flex items-center justify-center rounded-lg border border-emerald-200 px-3 py-1 text-emerald-600 transition hover:bg-emerald-50",children:"Assign branch"}),(0,r.jsx)("button",{type:"button",onClick:()=>O(e),className:"inline-flex items-center justify-center rounded-lg border border-blue-200 px-3 py-1 text-blue-600 transition hover:bg-blue-50",children:"Reset password"}),(0,r.jsx)("button",{type:"button",onClick:()=>q(e.email),className:"inline-flex items-center justify-center rounded-lg border border-red-200 px-3 py-1 text-red-600 transition hover:bg-red-50",children:"Delete"})]})]})},e.email)})}),(0,r.jsx)(m,{title:"Create admin",open:p,onClose:()=>{g||(h(!1),_())},children:(0,r.jsxs)("form",{className:"space-y-4",onSubmit:P,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"admin-email",children:"Email"}),(0,r.jsx)("input",{id:"admin-email",type:"email",required:!0,value:x.email,onChange:e=>f(s=>({...s,email:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",placeholder:"admin@restaurant.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"admin-password",children:"Password"}),(0,r.jsx)("input",{id:"admin-password",required:!0,type:"password",value:x.password,onChange:e=>f(s=>({...s,password:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",placeholder:"Temporary password"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"admin-branch",children:"Assign branch (optional)"}),(0,r.jsxs)("select",{id:"admin-branch",value:x.branchId,onChange:e=>f(s=>({...s,branchId:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",children:[(0,r.jsx)("option",{value:"",children:"Unassigned"}),u.branches.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsx)("button",{type:"button",className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100",onClick:()=>{_(),h(!1)},disabled:g,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:g,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:g?"Creating…":"Create admin"})]})]})}),(0,r.jsx)(m,{title:w?"Reset password for ".concat(w):"Reset password",open:!!w,onClose:()=>{A||D()},children:(0,r.jsxs)("form",{className:"space-y-4",onSubmit:B,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"edit-password",children:"New password"}),(0,r.jsx)("input",{id:"edit-password",type:"password",required:!0,value:N.password,onChange:e=>j(s=>({...s,password:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsx)("button",{type:"button",className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100",onClick:()=>{A||D()},disabled:A,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:A,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:A?"Saving…":"Save changes"})]})]})}),(0,r.jsx)(m,{title:C?"unassign"===E?"Unassign branch from ".concat(C.email):"Assign branch to ".concat(C.email):"Assign branch",open:!!C,onClose:()=>{U||F()},children:(0,r.jsxs)("form",{className:"space-y-4",onSubmit:z,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"assign-branch",children:"Select branch"}),(0,r.jsxs)("select",{id:"assign-branch",required:!0,value:E,onChange:e=>k(e.target.value),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",disabled:U,children:[(0,r.jsx)("option",{value:"",disabled:!0,children:"Choose branch"}),(0,r.jsx)("option",{value:"unassign",children:"Unassign"}),u.branches.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsx)("button",{type:"button",className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100",onClick:()=>{U||F()},disabled:U,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:U||!E,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:U?"unassign"===E?"Unassigning…":"Assigning…":"unassign"===E?"Unassign":"Assign branch"})]})]})})]}):(0,r.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-6 py-4 text-sm text-red-700",children:"Your JWT is missing the required restaurant identifier. Please contact support."})}function m(e){let{title:s,open:n,onClose:a,children:t}=e;return n?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 px-4",children:(0,r.jsxs)("div",{className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s}),(0,r.jsxs)("button",{type:"button",onClick:a,className:"rounded-full p-2 text-slate-500 transition hover:bg-slate-100 hover:text-slate-700",children:[(0,r.jsx)("span",{className:"sr-only",children:"Close"}),"\xd7"]})]}),(0,r.jsx)("div",{className:"mt-4",children:t})]})}):null}},620:function(e,s,n){"use strict";n.d(s,{$6:function(){return u},NA:function(){return c},Pz:function(){return i},Qj:function(){return o},RZ:function(){return h},UL:function(){return f},Vz:function(){return l},aq:function(){return p},jP:function(){return x},o_:function(){return d},uV:function(){return b},zu:function(){return m}});var r=n(533),a=n(2911);let t=e=>encodeURIComponent(e.toLowerCase()),l=async(e,s)=>{if(r.NA)return console.log("[Mock] getRestaurant"),a.Vu;let{data:n}=await e.get("/restaurants/".concat(s));return n},i=async(e,s)=>{if(r.NA)return console.log("[Mock] listBranches"),a.aE.filter(e=>e.restaurantId===s);let{data:n}=await e.get("/restaurants/".concat(s,"/branches"));return null!=n?n:[]},o=async(e,s,n)=>{if(r.NA){var t;console.log("[Mock] createBranch");let e={id:Date.now(),restaurantId:s,name:n.name,adminUserId:null!==(t=n.adminUserId)&&void 0!==t?t:null};return a.aE.push(e),e}let l={name:n.name,restaurantId:s};void 0!==n.adminUserId&&null!==n.adminUserId&&(l.adminUserId=n.adminUserId);let{data:i}=await e.post("/restaurants/".concat(s,"/branches"),l);return i},d=async(e,s,n)=>{if(r.NA){console.log("[Mock] updateBranch");let e=a.aE.find(e=>e.id===s);if(e)return n.name&&(e.name=n.name),void 0!==n.adminUserId&&(e.adminUserId=n.adminUserId),e;throw Error("Branch not found")}let{data:t}=await e.put("/branches/".concat(s),n);return t},c=async(e,s)=>{if(r.NA){console.log("[Mock] deleteBranch");let e=a.aE.findIndex(e=>e.id===s);-1!==e&&a.aE.splice(e,1);return}await e.delete("/branches/".concat(s))},u=async(e,s,n)=>{if(r.NA){console.log("[Mock] assignAdminToBranch");let e=a.aE.find(e=>e.id===s);e&&(e.adminUserId=n);return}await e.post("/branches/".concat(s,"/assign-admin"),{adminUserId:n})},m=async(e,s)=>{if(r.NA)return console.log("[Mock] listAdminsForRestaurant"),a.yv.filter(e=>e.restaurantId===s&&"ROLE_ADMIN"===e.role);let{data:n}=await e.get("/users",{params:{restaurantId:s}});return(null!=n?n:[]).filter(e=>"ROLE_ADMIN"===e.role)},b=async(e,s,n)=>{if(r.NA){var t;console.log("[Mock] createAdmin");let e={id:Date.now(),email:n.email.toLowerCase(),role:"ROLE_ADMIN",restaurantId:s,branchId:null!==(t=n.branchId)&&void 0!==t?t:null,fullName:"New Admin"};return a.yv.push(e),e}let{data:l}=await e.post("/superadmin/users",{email:n.email.toLowerCase(),password:n.password,role:"BRANCH_MANAGER",restaurantId:s,...void 0!==n.branchId&&null!==n.branchId?{branchId:n.branchId}:{}});return l},p=async(e,s,n)=>{if(r.NA){console.log("[Mock] updateAdmin");let e=a.yv.find(e=>e.email.toLowerCase()===s.toLowerCase());if(e)return void 0!==n.branchId&&(e.branchId=n.branchId),e;throw Error("Admin not found")}let{data:l}=await e.patch("/users/".concat(t(s)),{...n.password?{password:n.password}:{},...void 0!==n.branchId?{branchId:n.branchId}:{}});return l},h=async(e,s,n)=>{if(r.NA){var t;console.log("[Mock] resetAdminPassword");let e=a.yv.find(e=>e.id===s);return{status:"success",message:"Password reset successfully (mock)",newPassword:n,adminEmail:null!==(t=null==e?void 0:e.email)&&void 0!==t?t:"admin@mock.com",adminUserId:s}}let{data:l}=await e.post("/superadmin/admins/".concat(s,"/reset-password"),{newPassword:n});return l},x=async(e,s)=>{if(r.NA){console.log("[Mock] deleteAdmin");let e=a.yv.findIndex(e=>e.email.toLowerCase()===s.toLowerCase());-1!==e&&a.yv.splice(e,1);return}await e.delete("/users/".concat(t(s)))},f=async(e,s)=>{if(r.NA)return console.log("[Mock] listRestaurantStaff"),a.yv.filter(e=>e.restaurantId===s&&"ROLE_ADMIN"!==e.role&&"ROLE_SUPERADMIN"!==e.role);let{data:n}=await e.get("/users",{params:{restaurantId:s}});return(null!=n?n:[]).filter(e=>"ROLE_ADMIN"!==e.role)}}},function(e){e.O(0,[301,842,971,117,744],function(){return e(e.s=8805)}),_N_E=e.O()}]);