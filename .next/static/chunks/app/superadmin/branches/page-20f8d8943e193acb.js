(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{9366:function(e,r,n){Promise.resolve().then(n.bind(n,3693))},3693:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return c}});var t=n(7437),a=n(2265),s=n(8734),l=n(2285),d=n(620);let i={name:"",adminUserId:""},o={branches:[],admins:[],loading:!0,error:null};function c(){var e;let{user:r}=(0,s.a)(),n=(0,l.h)(),[c,h]=(0,a.useState)(o),[b,x]=(0,a.useState)(!1),[f,p]=(0,a.useState)(i),[g,N]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[w,j]=(0,a.useState)(i),[I,A]=(0,a.useState)(!1),C=null!==(e=null==r?void 0:r.restaurantId)&&void 0!==e?e:null;(0,a.useEffect)(()=>{let e=!1,t=async()=>{if(!C){h({branches:[],admins:[],loading:!1,error:"Restaurant assignment missing in JWT."});return}h(e=>({...e,loading:!0,error:null}));try{let[r,t]=await Promise.all([(0,d.Pz)(n,C),(0,d.zu)(n,C)]);if(e)return;h({branches:r,admins:t,loading:!1,error:null})}catch(r){if(console.error("[SuperadminBranches] load error",r),e)return;h({branches:[],admins:[],loading:!1,error:"Failed to load branches."})}};return(null==r?void 0:r.role)==="ROLE_SUPERADMIN"?t():h(o),()=>{e=!0}},[n,C,r]);let U=(0,a.useMemo)(()=>{let e=new Map;return c.admins.forEach(r=>e.set(r.id,r)),e},[c.admins]),E=()=>p(i),k=()=>{y(null),j(i)},M=async e=>{if(e.preventDefault(),C){N(!0),h(e=>({...e,error:null}));try{let e=await (0,d.Qj)(n,C,{name:f.name.trim(),adminUserId:f.adminUserId?Number(f.adminUserId):null});h(r=>({...r,branches:[e,...r.branches]})),E(),x(!1)}catch(e){console.error("[SuperadminBranches] create error",e),h(e=>({...e,error:"Failed to create branch. Please try again."}))}finally{N(!1)}}},S=e=>{var r;y(e),j({name:null!==(r=e.name)&&void 0!==r?r:"",adminUserId:e.adminUserId?String(e.adminUserId):""})},R=async e=>{if(e.preventDefault(),v){A(!0),h(e=>({...e,error:null}));try{let e=await (0,d.o_)(n,v.id,{name:w.name.trim(),adminUserId:w.adminUserId?Number(w.adminUserId):null});h(r=>({...r,branches:r.branches.map(r=>r.id===e.id?e:r)})),k()}catch(e){console.error("[SuperadminBranches] update error",e),h(e=>({...e,error:"Failed to update branch."}))}finally{A(!1)}}},L=async e=>{if(confirm("Delete this branch? This action cannot be undone.")){h(e=>({...e,error:null}));try{await (0,d.NA)(n,e),h(r=>({...r,branches:r.branches.filter(r=>r.id!==e)})),(null==v?void 0:v.id)===e&&k()}catch(e){console.error("[SuperadminBranches] delete error",e),h(e=>({...e,error:"Failed to delete branch."}))}}};return(null==r?void 0:r.role)!=="ROLE_SUPERADMIN"?(0,t.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-6 py-4 text-sm text-amber-900",children:"Access restricted to SuperAdmin role."}):C?(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("header",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Branches"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Create and manage the branches belonging to your restaurant tenant."})]}),(0,t.jsx)("button",{type:"button",className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700",onClick:()=>{E(),x(!0)},children:"+ Create branch"})]}),c.error?(0,t.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:c.error}):null,c.loading?(0,t.jsx)("div",{className:"rounded-lg border border-slate-200 bg-white px-4 py-3 text-sm text-slate-500",children:"Loading branches…"}):0===c.branches.length?(0,t.jsx)("div",{className:"rounded-lg border border-dashed border-slate-300 bg-white px-4 py-6 text-center text-sm text-slate-500",children:"No branches found. Create your first branch to get started."}):(0,t.jsx)("div",{className:"space-y-3",children:c.branches.map(e=>{let r=e.adminUserId?U.get(e.adminUserId):null;return(0,t.jsx)("article",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:e.name}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-slate-500",children:["Branch ID: ",e.id]}),(0,t.jsx)("dl",{className:"mt-3 grid gap-2 text-sm text-slate-600 sm:grid-cols-2",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Assigned admin"}),(0,t.jsx)("dd",{className:"mt-1 text-base text-slate-900",children:r?r.email:"Unassigned"})]})})]}),(0,t.jsxs)("div",{className:"flex gap-2 text-xs font-medium text-slate-600",children:[(0,t.jsx)("button",{type:"button",onClick:()=>S(e),className:"inline-flex items-center rounded-lg border border-blue-200 px-3 py-1 text-blue-600 transition hover:bg-blue-50",children:"Edit"}),(0,t.jsx)("button",{type:"button",onClick:()=>L(e.id),className:"inline-flex items-center rounded-lg border border-red-200 px-3 py-1 text-red-600 transition hover:bg-red-50",children:"Delete"})]})]})},e.id)})}),(0,t.jsx)(u,{title:"Create branch",open:b,onClose:()=>{g||(x(!1),E())},children:(0,t.jsxs)("form",{className:"space-y-4",onSubmit:M,children:[(0,t.jsx)(m,{form:f,admins:c.admins,disabled:g,onChange:p}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{type:"button",className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100",onClick:()=>{E(),x(!1)},disabled:g,children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:g,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:g?"Creating…":"Create branch"})]})]})}),(0,t.jsx)(u,{title:v?"Edit ".concat(v.name):"Edit branch",open:!!v,onClose:()=>{I||k()},children:(0,t.jsxs)("form",{className:"space-y-4",onSubmit:R,children:[(0,t.jsx)(m,{form:w,admins:c.admins,disabled:I,onChange:j}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)("button",{type:"button",className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100",onClick:()=>{I||k()},disabled:I,children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:I,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:I?"Saving…":"Save changes"})]})]})})]}):(0,t.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-6 py-4 text-sm text-red-700",children:"Your JWT is missing the required restaurant identifier. Please contact support."})}function u(e){let{title:r,open:n,onClose:a,children:s}=e;return n?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 px-4",children:(0,t.jsxs)("div",{className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:r}),(0,t.jsxs)("button",{type:"button",onClick:a,className:"rounded-full p-2 text-slate-500 transition hover:bg-slate-100 hover:text-slate-700",children:[(0,t.jsx)("span",{className:"sr-only",children:"Close"}),"\xd7"]})]}),(0,t.jsx)("div",{className:"mt-4",children:s})]})}):null}function m(e){let{form:r,admins:n,disabled:a,onChange:s}=e;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"branch-name",children:"Branch name"}),(0,t.jsx)("input",{id:"branch-name",required:!0,value:r.name,onChange:e=>s({...r,name:e.target.value}),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",placeholder:"Downtown",disabled:a})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"branch-admin",children:"Assign admin (optional)"}),(0,t.jsxs)("select",{id:"branch-admin",value:r.adminUserId,onChange:e=>s({...r,adminUserId:e.target.value}),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",disabled:a,children:[(0,t.jsx)("option",{value:"",children:"Unassigned"}),n.map(e=>(0,t.jsx)("option",{value:e.id,children:e.email},e.id))]})]})]})}},620:function(e,r,n){"use strict";n.d(r,{$6:function(){return u},NA:function(){return c},Pz:function(){return d},Qj:function(){return i},RZ:function(){return x},UL:function(){return p},Vz:function(){return l},aq:function(){return b},jP:function(){return f},o_:function(){return o},uV:function(){return h},zu:function(){return m}});var t=n(533),a=n(2911);let s=e=>encodeURIComponent(e.toLowerCase()),l=async(e,r)=>{if(t.NA)return console.log("[Mock] getRestaurant"),a.Vu;let{data:n}=await e.get("/restaurants/".concat(r));return n},d=async(e,r)=>{if(t.NA)return console.log("[Mock] listBranches"),a.aE.filter(e=>e.restaurantId===r);let{data:n}=await e.get("/restaurants/".concat(r,"/branches"));return null!=n?n:[]},i=async(e,r,n)=>{if(t.NA){var s;console.log("[Mock] createBranch");let e={id:Date.now(),restaurantId:r,name:n.name,adminUserId:null!==(s=n.adminUserId)&&void 0!==s?s:null};return a.aE.push(e),e}let l={name:n.name,restaurantId:r};void 0!==n.adminUserId&&null!==n.adminUserId&&(l.adminUserId=n.adminUserId);let{data:d}=await e.post("/restaurants/".concat(r,"/branches"),l);return d},o=async(e,r,n)=>{if(t.NA){console.log("[Mock] updateBranch");let e=a.aE.find(e=>e.id===r);if(e)return n.name&&(e.name=n.name),void 0!==n.adminUserId&&(e.adminUserId=n.adminUserId),e;throw Error("Branch not found")}let{data:s}=await e.put("/branches/".concat(r),n);return s},c=async(e,r)=>{if(t.NA){console.log("[Mock] deleteBranch");let e=a.aE.findIndex(e=>e.id===r);-1!==e&&a.aE.splice(e,1);return}await e.delete("/branches/".concat(r))},u=async(e,r,n)=>{if(t.NA){console.log("[Mock] assignAdminToBranch");let e=a.aE.find(e=>e.id===r);e&&(e.adminUserId=n);return}await e.post("/branches/".concat(r,"/assign-admin"),{adminUserId:n})},m=async(e,r)=>{if(t.NA)return console.log("[Mock] listAdminsForRestaurant"),a.yv.filter(e=>e.restaurantId===r&&"ROLE_ADMIN"===e.role);let{data:n}=await e.get("/users",{params:{restaurantId:r}});return(null!=n?n:[]).filter(e=>"ROLE_ADMIN"===e.role)},h=async(e,r,n)=>{if(t.NA){var s;console.log("[Mock] createAdmin");let e={id:Date.now(),email:n.email.toLowerCase(),role:"ROLE_ADMIN",restaurantId:r,branchId:null!==(s=n.branchId)&&void 0!==s?s:null,fullName:"New Admin"};return a.yv.push(e),e}let{data:l}=await e.post("/superadmin/users",{email:n.email.toLowerCase(),password:n.password,role:"BRANCH_MANAGER",restaurantId:r,...void 0!==n.branchId&&null!==n.branchId?{branchId:n.branchId}:{}});return l},b=async(e,r,n)=>{if(t.NA){console.log("[Mock] updateAdmin");let e=a.yv.find(e=>e.email.toLowerCase()===r.toLowerCase());if(e)return void 0!==n.branchId&&(e.branchId=n.branchId),e;throw Error("Admin not found")}let{data:l}=await e.patch("/users/".concat(s(r)),{...n.password?{password:n.password}:{},...void 0!==n.branchId?{branchId:n.branchId}:{}});return l},x=async(e,r,n)=>{if(t.NA){var s;console.log("[Mock] resetAdminPassword");let e=a.yv.find(e=>e.id===r);return{status:"success",message:"Password reset successfully (mock)",newPassword:n,adminEmail:null!==(s=null==e?void 0:e.email)&&void 0!==s?s:"admin@mock.com",adminUserId:r}}let{data:l}=await e.post("/superadmin/admins/".concat(r,"/reset-password"),{newPassword:n});return l},f=async(e,r)=>{if(t.NA){console.log("[Mock] deleteAdmin");let e=a.yv.findIndex(e=>e.email.toLowerCase()===r.toLowerCase());-1!==e&&a.yv.splice(e,1);return}await e.delete("/users/".concat(s(r)))},p=async(e,r)=>{if(t.NA)return console.log("[Mock] listRestaurantStaff"),a.yv.filter(e=>e.restaurantId===r&&"ROLE_ADMIN"!==e.role&&"ROLE_SUPERADMIN"!==e.role);let{data:n}=await e.get("/users",{params:{restaurantId:r}});return(null!=n?n:[]).filter(e=>"ROLE_ADMIN"!==e.role)}}},function(e){e.O(0,[301,842,971,117,744],function(){return e(e.s=9366)}),_N_E=e.O()}]);