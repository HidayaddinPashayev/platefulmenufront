(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[398],{2199:function(e,r,t){Promise.resolve().then(t.bind(t,9691))},9691:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return o}});var s=t(7437),a=t(2265),n=t(791),c=t(9376),l=t(6158);function i(){let e=(0,c.useRouter)(),r=(0,c.useSearchParams)(),[t,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(!1),h=(0,a.useRef)(null),b=(0,a.useCallback)(async(r,t)=>{m(!0);try{let s=await (0,l.IR)(r,t);localStorage.setItem("customerSession",JSON.stringify(s)),localStorage.setItem("customerBranchId",String(r)),localStorage.setItem("customerTableId",String(t)),e.push("/customer/menu")}catch(e){console.error("Session start error",e),i("Failed to start session. Please try scanning again."),m(!1),d(!0)}},[e]),f=(0,a.useCallback)(async e=>{if(!h.current)return;await h.current.stop(),d(!1);let r=1,t=1;try{if(e.includes("table=")&&e.includes("branch=")){let s=new URL(e);r=Number(s.searchParams.get("table")),t=Number(s.searchParams.get("branch"))}else if(e.includes("table:")){let s=e.split(";"),a=s.find(e=>e.includes("table:")),n=s.find(e=>e.includes("branch:"));a&&(r=parseInt(a.split(":")[1])),n&&(t=parseInt(n.split(":")[1]))}await b(t,r)}catch(e){console.error("Scan parse error",e),i("Invalid QR code format."),d(!0)}},[b]);return((0,a.useEffect)(()=>{let e=r.get("table"),t=r.get("branch");e&&t&&(d(!1),b(Number(t),Number(e)))},[r,b]),(0,a.useEffect)(()=>{if(!o||u)return;let e=new n.t2("reader");return h.current=e,(async()=>{try{await e.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},e=>{f(e)},e=>{})}catch(e){console.error("Failed to start scanner",e),i("Could not access camera. Please ensure you have granted permission."),d(!1)}})(),()=>{h.current&&h.current.isScanning&&h.current.stop().catch(console.error)}},[o,u,f]),u)?(0,s.jsxs)("div",{className:"min-h-screen bg-warm-50 flex flex-col items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-warm-600 mb-4"}),(0,s.jsx)("p",{className:"text-warm-800 font-medium",children:"Starting your session..."})]}):(0,s.jsx)("div",{className:"min-h-screen bg-warm-50 flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-md space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-warm-900",children:"Scan QR Code"}),(0,s.jsx)("p",{className:"text-warm-500 mt-2",children:"Scan the code on your table to order"})]}),(0,s.jsxs)("div",{className:"card overflow-hidden bg-black relative rounded-2xl shadow-xl",children:[(0,s.jsx)("div",{id:"reader",className:"w-full h-64 md:h-80"}),(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none border-2 border-warm-500/50 rounded-2xl"})]}),t&&(0,s.jsx)("div",{className:"p-4 bg-red-50 text-red-700 rounded-xl text-sm text-center border border-red-100",children:t}),(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)("p",{className:"text-sm text-warm-400",children:"- OR -"}),(0,s.jsx)("button",{onClick:()=>{b(1,1)},className:"btn btn-secondary w-full",children:"Simulate Scan (Demo)"})]})]})})}function o(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-warm-50 flex items-center justify-center",children:"Loading..."}),children:(0,s.jsx)(i,{})})}}},function(e){e.O(0,[52,884,158,971,117,744],function(){return e(e.s=2199)}),_N_E=e.O()}]);