(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[643],{5136:function(e,t,s){Promise.resolve().then(s.bind(s,102))},102:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var l=s(7437),n=s(2265),a=s(8734),r=s(2285),i=s(533);s(2911);let o=async(e,t)=>{if(i.NA)return console.log("[Mock] getKitchenPinInfo"),{branchId:t,isSet:!0,lastUpdatedAt:new Date().toISOString(),maskedPin:"**1234"};try{let{data:s}=await e.get("/branches/".concat(t,"/kitchen/pin"));return s}catch(e){var s,l;throw console.error("[getKitchenPinInfo] Error:",{branchId:t,status:null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status,data:null==e?void 0:null===(l=e.response)||void 0===l?void 0:l.data}),e}},c=async(e,t)=>{if(i.NA){console.log("[Mock] generateKitchenPin");let e=String(Math.floor(1e5+9e5*Math.random()));return{branchId:t,isSet:!0,lastUpdatedAt:new Date().toISOString(),maskedPin:"**".concat(e.slice(-4)),pin:e}}try{let{data:s}=await e.post("/branches/".concat(t,"/kitchen/pin/generate"));return s}catch(e){var s,l;throw console.error("[generateKitchenPin] Error:",{branchId:t,status:null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status,data:null==e?void 0:null===(l=e.response)||void 0===l?void 0:l.data}),e}},d=async(e,t,s)=>{if(i.NA)return console.log("[Mock] setKitchenPin"),{branchId:t,isSet:!0,lastUpdatedAt:new Date().toISOString(),maskedPin:"**".concat(s.slice(-4))};try{let{data:l}=await e.post("/branches/".concat(t,"/kitchen/pin"),{pin:s});return l}catch(e){var l,n;throw console.error("[setKitchenPin] Error:",{branchId:t,status:null==e?void 0:null===(l=e.response)||void 0===l?void 0:l.status,data:null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data}),e}};function m(){var e;let{user:t}=(0,a.a)(),s=(0,r.h)(),i=null!==(e=null==t?void 0:t.branchId)&&void 0!==e?e:null,[m,u]=(0,n.useState)(null),[x,h]=(0,n.useState)(!0),[b,g]=(0,n.useState)(null),[p,N]=(0,n.useState)(null),[v,f]=(0,n.useState)(""),[j,w]=(0,n.useState)(!1),[y,P]=(0,n.useState)(null),[k,I]=(0,n.useState)(!1),[S,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!i)return;let e="kitchenPin_branch_".concat(i),t=localStorage.getItem(e);t&&P(t)},[i]),(0,n.useEffect)(()=>{if(!i){g("Your account is missing branch assignment."),h(!1);return}(async()=>{try{h(!0),g(null);let e=await o(s,i);u(e)}catch(s){var e,t;console.error("[AdminKitchen] Load PIN info error:",s),g((null==s?void 0:null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to load kitchen PIN information.")}finally{h(!1)}})()},[i,s]);let A=async()=>{if(i&&confirm("Generate a new random PIN? The current PIN will be replaced."))try{C(!0),g(null),N(null);let e=await c(s,i),t=e.pin||null;if(t){P(t);let e="kitchenPin_branch_".concat(i);localStorage.setItem(e,t)}u(e),N("New PIN generated successfully!")}catch(s){var e,t;console.error("[AdminKitchen] Generate PIN error:",s),g((null==s?void 0:null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to generate PIN. Please try again.")}finally{C(!1)}},M=async e=>{if(e.preventDefault(),i){if(6!==v.length||!/^\d{6}$/.test(v)){g("PIN must be exactly 6 digits.");return}try{I(!0),g(null),N(null);let e=await d(s,i,v);u(e),P(v);let t="kitchenPin_branch_".concat(i);localStorage.setItem(t,v),f(""),w(!1),N("PIN updated successfully!")}catch(e){var t,l;console.error("[AdminKitchen] Set PIN error:",e),g((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.message)||"Failed to set PIN. Please try again.")}finally{I(!1)}}};return i?(0,l.jsx)("div",{className:"flex min-h-screen bg-slate-100 px-4 py-8",children:(0,l.jsxs)("div",{className:"mx-auto w-full max-w-2xl",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Kitchen Settings"}),(0,l.jsxs)("p",{className:"mt-2 text-sm text-slate-600",children:["Manage the 6-digit PIN for kitchen device authentication (Branch #",i,")"]})]}),p&&(0,l.jsx)("div",{className:"mb-6 animate-in fade-in slide-in-from-top-2 duration-300",children:(0,l.jsx)("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("svg",{className:"h-5 w-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("div",{className:"ml-3 flex-1",children:(0,l.jsx)("p",{className:"text-sm font-medium text-green-800",children:p})}),(0,l.jsx)("button",{onClick:()=>N(null),className:"ml-4 text-green-600 hover:text-green-800",children:"\xd7"})]})})}),b&&(0,l.jsx)("div",{className:"mb-6 animate-in fade-in slide-in-from-top-2 duration-300",children:(0,l.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("svg",{className:"h-5 w-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("div",{className:"ml-3 flex-1",children:(0,l.jsx)("p",{className:"text-sm font-medium text-red-800",children:b})}),(0,l.jsx)("button",{onClick:()=>g(null),className:"ml-4 text-red-600 hover:text-red-800",children:"\xd7"})]})})}),(0,l.jsxs)("div",{className:"mb-6 rounded-lg border border-slate-200 bg-white p-6 shadow-sm",children:[(0,l.jsx)("h2",{className:"mb-4 text-xl font-semibold text-slate-900",children:"Current PIN Status"}),x?(0,l.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,l.jsxs)("svg",{className:"h-6 w-6 animate-spin text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,l.jsx)("span",{className:"ml-2 text-sm text-slate-600",children:"Loading PIN information..."})]}):m?(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Status:"}),(0,l.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat(m.isSet?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:m.isSet?"PIN Set":"No PIN Set"})]}),(0,l.jsx)("div",{className:"rounded-lg border-2 border-blue-500 bg-gradient-to-br from-blue-50 to-blue-100 p-8 shadow-lg",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"mb-4 text-base font-semibold text-blue-900",children:"Current Kitchen PIN"}),y?(0,l.jsx)("span",{className:"inline-block font-mono text-6xl font-bold text-blue-600 tracking-wider",children:y}):(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-mono text-4xl font-bold text-slate-400",children:m.maskedPin||"••••••"}),(0,l.jsx)("p",{className:"mt-3 text-sm text-slate-500",children:"PIN not stored locally. Generate or set a new PIN to view it here permanently."})]})]})}),m.lastUpdatedAt&&(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Last Updated:"}),(0,l.jsx)("span",{className:"text-sm text-slate-600",children:(e=>{if(!e)return"N/A";try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return"Invalid date"}})(m.lastUpdatedAt)})]})]}):(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"Failed to load PIN information."})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-6 shadow-sm",children:[(0,l.jsx)("h2",{className:"mb-4 text-xl font-semibold text-slate-900",children:"Generate Random PIN"}),(0,l.jsx)("p",{className:"mb-4 text-sm text-slate-600",children:"Generate a secure 6-digit random PIN. The full PIN will be shown once for you to save."}),(0,l.jsx)("button",{onClick:A,disabled:x||S,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:S?(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"Generate Random PIN"})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-6 shadow-sm",children:[(0,l.jsx)("h2",{className:"mb-4 text-xl font-semibold text-slate-900",children:"Set Custom PIN"}),(0,l.jsx)("p",{className:"mb-4 text-sm text-slate-600",children:"Set a custom 6-digit PIN of your choice."}),j?(0,l.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"customPin",className:"block text-sm font-medium text-slate-700",children:"6-Digit PIN"}),(0,l.jsx)("input",{id:"customPin",type:"text",inputMode:"numeric",pattern:"[0-9]{6}",maxLength:6,value:v,onChange:e=>{f(e.target.value.replace(/\D/g,"").slice(0,6)),g(null)},placeholder:"000000",className:"mt-1 block w-full rounded-lg border border-slate-300 px-4 py-2 font-mono text-lg tracking-widest focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Enter exactly 6 numeric digits (0-9)"})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{type:"submit",disabled:k||6!==v.length,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:k?"Saving...":"Save PIN"}),(0,l.jsx)("button",{type:"button",onClick:()=>{w(!1),f(""),g(null)},disabled:k,className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",children:"Cancel"})]})]}):(0,l.jsx)("button",{onClick:()=>{w(!0),g(null),f("")},className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-50",children:"Set Custom PIN"})]})]})]})}):(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-100 px-4",children:(0,l.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-6 py-4 text-red-700",children:"Your account is missing branch assignment. Please contact your administrator."})})}}},function(e){e.O(0,[301,842,971,117,744],function(){return e(e.s=5136)}),_N_E=e.O()}]);