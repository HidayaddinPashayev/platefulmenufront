(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[658],{2422:function(e,t,l){Promise.resolve().then(l.bind(l,9182))},9182:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return d}});var a=l(7437),r=l(2265),s=l(8734),n=l(2285),o=l(6997);let i={name:"",seatCount:"",tableNumber:"",active:!0};function d(){var e,t,l;let{user:d}=(0,s.a)(),u=(0,n.h)(),[c,m]=(0,r.useState)([]),[b,x]=(0,r.useState)(!0),[h,N]=(0,r.useState)(null),[f,p]=(0,r.useState)(i),[v,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),[A,k]=(0,r.useState)({name:"",seatCount:"",tableNumber:"",active:!0}),[I,S]=(0,r.useState)(!1),[T,E]=(0,r.useState)(null),P=null!==(e=null==d?void 0:d.branchId)&&void 0!==e?e:null,M=null!==(t=null==d?void 0:d.restaurantId)&&void 0!==t?t:null;(0,r.useEffect)(()=>{let e=!1,t=async()=>{if(!M||!P){m([]),x(!1),N("Your profile is missing restaurant or branch assignments.");return}x(!0),N(null);try{let t=await (0,o.Xn)(u,M,P);e||m(t)}catch(t){console.error("[AdminTables] load error",t),e||N("Failed to load table list.")}finally{e||x(!1)}};return(null==d?void 0:d.role)==="ROLE_ADMIN"?t():x(!1),()=>{e=!0}},[u,P,M,d]);let F=async()=>{if(M&&P)try{let e=await (0,o.Xn)(u,M,P);m(e)}catch(e){console.error("[AdminTables] refresh error",e),N("Failed to refresh table list.")}},R=async e=>{if(e.preventDefault(),M&&P){g(!0),N(null);try{let e=f.seatCount?Number(f.seatCount):null,t=f.tableNumber?Number(f.tableNumber):null;await (0,o.W_)(u,M,P,{name:f.name.trim()||"Table ".concat(Date.now()),seatCount:e,tableNumber:t}),p(i),await F()}catch(e){console.error("[AdminTables] create error",e),N("Failed to create table.")}finally{g(!1)}}},_=e=>{var t,l;j(e.id),C(e),k({name:null!==(t=e.name)&&void 0!==t?t:"",seatCount:null!=e.seatCount?String(e.seatCount):"",tableNumber:null!=e.tableNumber?String(e.tableNumber):"",active:null===(l=e.active)||void 0===l||l})},L=()=>{j(null),C(null),k({name:"",seatCount:"",tableNumber:"",active:!0})},D=async e=>{if(e.preventDefault(),null!=y&&w){S(!0),N(null);try{let e=A.seatCount?Number(A.seatCount):null,t=A.tableNumber?Number(A.tableNumber):null;await (0,o.T0)(u,y,{name:A.name.trim()||"Table ".concat(y),seatCount:e,tableNumber:t,restaurantId:w.restaurantId,branchId:w.branchId}),L(),await F()}catch(e){console.error("[AdminTables] update error",e),N("Failed to update table.")}finally{S(!1)}}},O=async e=>{if(confirm("Remove this table?")){N(null);try{await (0,o.WQ)(u,e),await F()}catch(e){console.error("[AdminTables] delete error",e),N("Failed to delete table.")}}};return(null==d?void 0:d.role)!=="ROLE_ADMIN"?(0,a.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-6 py-4 text-sm text-amber-900",children:"Access restricted to Admin role."}):M&&P?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("header",{className:"space-y-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Tables"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Manage the tables assigned to your branch, including capacity and numbering."})]}),h?(0,a.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:h}):null,(0,a.jsxs)("section",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"Add table"}),(0,a.jsxs)("form",{className:"mt-4 grid gap-4 md:grid-cols-2 lg:grid-cols-4",onSubmit:R,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"table-name",children:"Table name"}),(0,a.jsx)("input",{id:"table-name",value:f.name,onChange:e=>p(t=>({...t,name:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",placeholder:"Window table"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"table-number",children:"Table number"}),(0,a.jsx)("input",{id:"table-number",value:f.tableNumber,onChange:e=>p(t=>({...t,tableNumber:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",placeholder:"Optional"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-slate-600",htmlFor:"table-seat",children:"Seat count"}),(0,a.jsx)("input",{id:"table-seat",value:f.seatCount,onChange:e=>p(t=>({...t,seatCount:e.target.value})),className:"mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none",placeholder:"4"})]}),(0,a.jsx)("div",{className:"md:col-span-2 lg:col-span-4 flex items-center gap-3",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,a.jsx)("input",{type:"checkbox",checked:f.active,onChange:e=>p(t=>({...t,active:e.target.checked})),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Active"]})}),(0,a.jsxs)("div",{className:"md:col-span-2 lg:col-span-4 flex items-center gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:v,className:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:v?"Adding…":"Add table"}),(0,a.jsx)("button",{type:"button",onClick:()=>p(i),className:"text-sm font-medium text-slate-500 hover:text-slate-700",disabled:v,children:"Reset"})]})]})]}),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"Current tables"}),(0,a.jsxs)("span",{className:"text-xs font-medium text-slate-500",children:[c.length," ",1===c.length?"table":"tables"]})]}),b?(0,a.jsx)("div",{className:"rounded-lg border border-slate-200 bg-white px-4 py-3 text-sm text-slate-500",children:"Loading tables…"}):0===c.length?(0,a.jsx)("div",{className:"rounded-lg border border-dashed border-slate-300 bg-white px-4 py-6 text-center text-sm text-slate-500",children:"No tables configured for this branch."}):(0,a.jsx)("div",{className:"grid gap-4 lg:grid-cols-2",children:c.map(e=>{var t,l,r;return y===e.id?(0,a.jsxs)("form",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",onSubmit:D,children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-base font-semibold text-blue-900",children:["Editing Table ",null!==(t=e.tableNumber)&&void 0!==t?t:e.id]}),(0,a.jsxs)("p",{className:"text-xs text-blue-700",children:["Table ID: ",e.id]})]}),(0,a.jsx)("button",{type:"button",className:"text-xs font-medium text-blue-700 hover:text-blue-900",onClick:L,disabled:I,children:"Cancel"})]}),(0,a.jsxs)("div",{className:"mt-3 grid gap-3 sm:grid-cols-3",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-blue-800",children:"Name"}),(0,a.jsx)("input",{value:A.name,onChange:e=>k(t=>({...t,name:e.target.value})),className:"mt-1 w-full rounded-lg border border-blue-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-blue-800",children:"Table number"}),(0,a.jsx)("input",{value:A.tableNumber,onChange:e=>k(t=>({...t,tableNumber:e.target.value})),className:"mt-1 w-full rounded-lg border border-blue-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-blue-800",children:"Seat count"}),(0,a.jsx)("input",{value:A.seatCount,onChange:e=>k(t=>({...t,seatCount:e.target.value})),className:"mt-1 w-full rounded-lg border border-blue-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"})]})]}),(0,a.jsxs)("label",{className:"mt-3 flex items-center gap-2 text-sm text-blue-800",children:[(0,a.jsx)("input",{type:"checkbox",checked:A.active,onChange:e=>k(t=>({...t,active:e.target.checked})),className:"h-4 w-4 rounded border-blue-300 text-blue-600 focus:ring-blue-500"}),"Active"]}),(0,a.jsx)("div",{className:"mt-4 flex items-center gap-3",children:(0,a.jsx)("button",{type:"submit",disabled:I,className:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:I?"Saving…":"Save changes"})})]},e.id):(0,a.jsx)("article",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-slate-900",children:["Table ",null!==(l=e.tableNumber)&&void 0!==l?l:e.id]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Seats ",null!==(r=e.seatCount)&&void 0!==r?r:"N/A"," • ",e.active?"Active":"Inactive"]}),e.name?(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Label: ",e.name]}):null,e.qrCode?(0,a.jsxs)("p",{className:"text-xs text-slate-400 break-all",children:["QR: ",e.qrCode]}):null]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 text-xs font-medium text-slate-600",children:[(0,a.jsx)("button",{type:"button",onClick:()=>E(e),className:"inline-flex items-center rounded-lg border border-slate-200 px-3 py-1 text-slate-700 transition hover:bg-slate-50",children:"QR Code"}),(0,a.jsx)("button",{type:"button",onClick:()=>_(e),className:"inline-flex items-center rounded-lg border border-blue-200 px-3 py-1 text-blue-600 transition hover:bg-blue-50",children:"Edit"}),(0,a.jsx)("button",{type:"button",onClick:()=>O(e.id),className:"inline-flex items-center rounded-lg border border-red-200 px-3 py-1 text-red-600 transition hover:bg-red-50",children:"Delete"})]})]})},e.id)})})]}),T&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"w-full max-w-sm rounded-2xl bg-white p-6 shadow-xl",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-slate-900",children:["Table ",null!==(l=T.tableNumber)&&void 0!==l?l:T.id]}),(0,a.jsx)("p",{className:"text-sm text-slate-500 mb-6",children:"Scan to view menu & order"}),(0,a.jsx)("div",{className:"mx-auto bg-white p-4 rounded-xl border border-slate-100 shadow-inner inline-block",children:(0,a.jsx)("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=".concat(encodeURIComponent("".concat(window.location.origin,"/scan?table=").concat(T.id,"&branch=").concat(T.branchId))),alt:"QR Code",className:"w-64 h-64"})}),(0,a.jsxs)("div",{className:"mt-6 flex justify-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>window.print(),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",children:"Print"}),(0,a.jsx)("button",{onClick:()=>E(null),className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"Close"})]})]})})})]}):(0,a.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-6 py-4 text-sm text-red-700",children:"Your administrator profile is missing restaurant or branch assignments. Please contact your SuperAdmin."})}},6997:function(e,t,l){"use strict";l.d(t,{Qf:function(){return d},T0:function(){return m},WQ:function(){return b},W_:function(){return c},Xn:function(){return u},Z6:function(){return o},aM:function(){return n},jK:function(){return i},l_:function(){return x}});var a=l(533),r=l(2911);let s=new Set(["ROLE_WAITER","ROLE_KITCHEN"]),n=async(e,t)=>{if(a.NA){console.log("[Mock] getBranch");let e=r.aE.find(e=>e.id===t);if(e)return e;throw Error("Branch not found")}let{data:l}=await e.get("/branches/".concat(t));return l},o=async(e,t)=>{if(a.NA)return console.log("[Mock] listStaff"),r.yv.filter(e=>e.branchId===t&&s.has(e.role));let{data:l}=await e.get("/users",{params:{branchId:t}});return(null!=l?l:[]).filter(e=>s.has(e.role))},i=async(e,t,l,s)=>{var n,o,i,d;if(a.NA){console.log("[Mock] createStaff");let e={id:Date.now(),email:s.email.toLowerCase(),role:s.role,restaurantId:t,branchId:l,fullName:"".concat(s.firstName||""," ").concat(s.lastName||"").trim()||"New Staff",firstName:s.firstName,lastName:s.lastName,phoneNumber:s.phoneNumber,salaryAmount:s.salaryAmount,salaryPeriod:s.salaryPeriod};return r.yv.push(e),e}let u={email:s.email.toLowerCase(),role:s.role,restaurantId:t,branchId:l};if(s.password&&(u.password=s.password),(null===(n=s.firstName)||void 0===n?void 0:n.trim())||(null===(o=s.lastName)||void 0===o?void 0:o.trim())){let e=(null===(i=s.firstName)||void 0===i?void 0:i.trim())||"",t=(null===(d=s.lastName)||void 0===d?void 0:d.trim())||"";u.fullName="".concat(e," ").concat(t).trim()}void 0!==s.phoneNumber&&null!==s.phoneNumber&&(u.phoneNumber=s.phoneNumber),void 0!==s.salaryAmount&&null!==s.salaryAmount&&(u.salaryAmount=Number(s.salaryAmount)),void 0!==s.salaryPeriod&&null!==s.salaryPeriod&&(u.salaryPeriod=s.salaryPeriod);let{data:c}=await e.post("/users",u);return c},d=async(e,t,l)=>{if(a.NA){console.log("[Mock] updateStaff");let e=r.yv.find(e=>e.email.toLowerCase()===t.toLowerCase());if(e)return l.role&&(e.role=l.role),l.firstName&&(e.firstName=l.firstName),l.lastName&&(e.lastName=l.lastName),(l.firstName||l.lastName)&&(e.fullName="".concat(l.firstName||e.firstName||""," ").concat(l.lastName||e.lastName||"").trim()),void 0!==l.phoneNumber&&(e.phoneNumber=l.phoneNumber),void 0!==l.salaryAmount&&(e.salaryAmount=l.salaryAmount),void 0!==l.salaryPeriod&&(e.salaryPeriod=l.salaryPeriod),void 0!==l.branchId&&(e.branchId=l.branchId),e;throw Error("Staff not found")}let s={};if(l.role&&(s.role=l.role),l.password&&(s.password=l.password),void 0!==l.firstName||void 0!==l.lastName){var n,o;let e=(null===(n=l.firstName)||void 0===n?void 0:n.trim())||"",t=(null===(o=l.lastName)||void 0===o?void 0:o.trim())||"";e&&(s.firstName=e),t&&(s.lastName=t),(e||t)&&(s.fullName="".concat(e," ").concat(t).trim())}void 0!==l.phoneNumber&&null!==l.phoneNumber&&(s.phoneNumber=l.phoneNumber),void 0!==l.salaryAmount&&null!==l.salaryAmount&&(s.salaryAmount=Number(l.salaryAmount)),void 0!==l.salaryPeriod&&null!==l.salaryPeriod&&(s.salaryPeriod=l.salaryPeriod),void 0!==l.branchId&&null!==l.branchId&&(s.branchId=l.branchId);let{data:i}=await e.patch("/users/".concat(encodeURIComponent(t.toLowerCase())),s);return i},u=async(e,t,l)=>{if(a.NA)return console.log("[Mock] listTables"),r.JF.filter(e=>e.branchId===l);let{data:s}=await e.get("/tables",{params:{restId:t}});return(null!=s?s:[]).filter(e=>e.branchId===l)},c=async(e,t,l,s)=>{var n,o,i,d,u,c;if(a.NA){console.log("[Mock] createTable");let e={id:Date.now(),restaurantId:t,branchId:l,name:null!==(n=s.name)&&void 0!==n?n:"New Table",tableNumber:null!==(o=s.tableNumber)&&void 0!==o?o:null,seatCount:null!==(i=s.seatCount)&&void 0!==i?i:null,active:!0,qrCode:"QR-".concat(Date.now())};return r.JF.push(e),e}let{data:m}=await e.post("/tables",{restaurantId:t,branchId:l,name:null!==(d=s.name)&&void 0!==d?d:"",tableNumber:null!==(u=s.tableNumber)&&void 0!==u?u:null,seatCount:null!==(c=s.seatCount)&&void 0!==c?c:null});return m},m=async(e,t,l)=>{var s,n,o,i;if(a.NA){console.log("[Mock] updateTable");let e=r.JF.find(e=>e.id===t);if(e)return void 0!==l.name&&(e.name=null!==(s=l.name)&&void 0!==s?s:""),void 0!==l.tableNumber&&(e.tableNumber=l.tableNumber),void 0!==l.seatCount&&(e.seatCount=l.seatCount),e;throw Error("Table not found")}let d={name:null!==(n=l.name)&&void 0!==n?n:"",tableNumber:null!==(o=l.tableNumber)&&void 0!==o?o:null,seatCount:null!==(i=l.seatCount)&&void 0!==i?i:null};void 0!==l.restaurantId&&(d.restaurantId=l.restaurantId),void 0!==l.branchId&&(d.branchId=l.branchId);let{data:u}=await e.put("/tables/".concat(t),d);return u},b=async(e,t)=>{if(a.NA){console.log("[Mock] deleteTable");let e=r.JF.findIndex(e=>e.id===t);-1!==e&&r.JF.splice(e,1);return}await e.delete("/tables/".concat(t))},x=async(e,t)=>{if(a.NA)return console.log("[Mock] listMenuItems"),r.LE.filter(e=>e.restaurantId===t);let{data:l}=await e.get("/menu/admin/all",{params:{restId:t}});return null!=l?l:[]}}},function(e){e.O(0,[301,842,971,117,744],function(){return e(e.s=2422)}),_N_E=e.O()}]);