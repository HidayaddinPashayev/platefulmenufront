(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[991],{3573:function(e,t,s){Promise.resolve().then(s.bind(s,2903))},9376:function(e,t,s){"use strict";var r=s(5475);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},257:function(e,t,s){"use strict";var r,n;e.exports=(null==(r=s.g.process)?void 0:r.env)&&"object"==typeof(null==(n=s.g.process)?void 0:n.env)?s.g.process:s(4227)},4227:function(e){!function(){var t={229:function(e){var t,s,r,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var c=[],o=!1,d=-1;function u(){o&&r&&(o=!1,r.length?c=r.concat(c):d=-1,c.length&&m())}function m(){if(!o){var e=i(u);o=!0;for(var t=c.length;t;){for(r=c,c=[];++d<t;)r&&r[d].run();d=-1,t=c.length}r=null,o=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new h(e,t)),1!==c.length||o||i(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=x,n.addListener=x,n.once=x,n.off=x,n.removeListener=x,n.removeAllListeners=x,n.emit=x,n.prependListener=x,n.prependOnceListener=x,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},s={};function r(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}},l=!0;try{t[e](a,a.exports,r),l=!1}finally{l&&delete s[e]}return a.exports}r.ab="//";var n=r(229);e.exports=n}()},2903:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var r=s(7437),n=s(2265),a=s(9376),l=s(533);function i(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),s=Number(e.branchId),[i,c]=(0,n.useState)(!1),o=(0,n.useRef)(!1),[d,u]=(0,n.useState)({ORDERED:[],PREPARING:[],PREPARED_WAITING:[]}),[m,h]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null),[p,b]=(0,n.useState)(null),N=(0,n.useCallback)(async()=>{if(i&&!isNaN(s))try{h(!0),f(null);let e=await fetch("".concat(l.CT,"/branches/").concat(s,"/kitchen/orders"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok){if(401===e.status){let r=await e.json().catch(()=>({}));if(!0===r.requiresPin){console.log("[KDS] PIN authentication required - redirecting"),t.replace("/kitchen/".concat(s));return}}if(403===e.status){console.log("[KDS] Access denied - redirecting to PIN page"),f("Access denied. Try logging in again."),t.replace("/kitchen/".concat(s));return}f("Failed to load orders. Please try again."),h(!1);return}let r=await e.json(),n={ORDERED:[],PREPARING:[],PREPARED_WAITING:[]};r.forEach(e=>{("ORDERED"===e.status||"PREPARING"===e.status||"PREPARED_WAITING"===e.status)&&n[e.status].push(e)}),u(n),console.log("[KDS] Orders fetched successfully")}catch(e){console.error("[KDS] Error fetching orders:",e),f("Failed to load orders. Please try again.")}finally{h(!1)}},[s,t,i]);if((0,n.useEffect)(()=>{c(!0),console.log("[KDS] Client-side mounted")},[]),(0,n.useEffect)(()=>{if(i&&!o.current){if(isNaN(s)){console.error("[KDS Orders] âŒ Invalid branch ID:",e.branchId),f("Invalid branch ID"),h(!1);return}o.current=!0,console.log("[KDS] Fetching orders"),N()}},[s,e.branchId,i,N]),(0,n.useEffect)(()=>{if(!i||m)return;let e=setInterval(()=>{N()},5e3);return()=>{clearInterval(e)}},[m,N,i]),!i)return null;let g=async e=>{if(!isNaN(s))try{b(e);let r=await fetch("".concat(l.CT,"/branches/").concat(s,"/kitchen/orders/").concat(e,"/accept"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){if(401===r.status||403===r.status){t.replace("/kitchen/".concat(s));return}alert("Failed to accept order. Please try again.");return}await N()}catch(e){console.error("[KDS] Error accepting order:",e),alert("Failed to accept order. Please try again.")}finally{b(null)}},j=async e=>{if(!isNaN(s))try{b(e);let r=await fetch("".concat(l.CT,"/branches/").concat(s,"/kitchen/orders/").concat(e,"/ready"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){if(401===r.status||403===r.status){t.replace("/kitchen/".concat(s));return}alert("Failed to mark order as ready. Please try again.");return}await N()}catch(e){console.error("[KDS] Error marking order ready:",e),alert("Failed to mark order as ready. Please try again.")}finally{b(null)}},y=e=>e?"$".concat((e/100).toFixed(2)):"$0.00",v=e=>{if(!e)return"";try{return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch(e){return""}};return isNaN(s)?(0,r.jsx)("main",{className:"min-h-screen bg-slate-900 p-4",children:(0,r.jsx)("div",{className:"mx-auto max-w-7xl",children:(0,r.jsx)("div",{className:"rounded-lg bg-red-500/20 border border-red-500/50 p-4 text-red-300",children:"Invalid branch ID"})})}):m&&0===d.ORDERED.length&&0===d.PREPARING.length&&0===d.PREPARED_WAITING.length?(0,r.jsx)("main",{className:"min-h-screen bg-slate-900 p-4",children:(0,r.jsx)("div",{className:"mx-auto max-w-7xl",children:(0,r.jsx)("div",{className:"text-center text-white",children:"Loading orders..."})})}):(0,r.jsx)("main",{className:"min-h-screen bg-slate-900 p-4",children:(0,r.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-white",children:["Kitchen - Branch ",s]}),(0,r.jsx)("button",{onClick:()=>{t.replace("/kitchen/".concat(s))},className:"rounded-lg bg-slate-700 px-4 py-2 text-sm font-medium text-white transition hover:bg-slate-600",children:"Logout"})]}),x&&(0,r.jsx)("div",{className:"mb-4 rounded-lg bg-red-500/20 border border-red-500/50 p-3 text-red-300",children:x}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,r.jsxs)("section",{className:"rounded-lg bg-slate-800 p-4",children:[(0,r.jsx)("h2",{className:"mb-4 border-b-2 border-yellow-500 pb-2 text-xl font-bold text-white",children:"New Orders"}),0===d.ORDERED.length?(0,r.jsx)("p",{className:"text-center text-slate-400",children:"No orders"}):(0,r.jsx)("div",{className:"space-y-3",children:d.ORDERED.map(e=>(0,r.jsxs)("div",{className:"rounded-lg border border-slate-600 bg-slate-700 p-4",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-semibold text-white",children:["Order #",e.id]}),(0,r.jsxs)("p",{className:"text-xs text-slate-400",children:["Table: ",e.tableName||e.tableId]}),e.createdAt&&(0,r.jsx)("p",{className:"text-xs text-slate-400",children:v(e.createdAt)})]}),e.totalCents&&(0,r.jsx)("p",{className:"text-sm font-medium text-white",children:y(e.totalCents)})]}),(0,r.jsx)("div",{className:"mb-3 space-y-1",children:e.items.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm text-slate-300",children:[(0,r.jsxs)("span",{className:"font-medium",children:[e.qty,"x"]})," ",e.menuItemName||"Item ".concat(e.menuItemId)]},t))}),e.notes&&(0,r.jsxs)("p",{className:"mb-3 text-xs text-yellow-400",children:["Note: ",e.notes]}),(0,r.jsx)("button",{onClick:()=>g(e.id),disabled:p===e.id,className:"w-full rounded-lg bg-green-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:p===e.id?"Processing...":"Accept Order"})]},e.id))})]}),(0,r.jsxs)("section",{className:"rounded-lg bg-slate-800 p-4",children:[(0,r.jsx)("h2",{className:"mb-4 border-b-2 border-yellow-500 pb-2 text-xl font-bold text-white",children:"Preparing"}),0===d.PREPARING.length?(0,r.jsx)("p",{className:"text-center text-slate-400",children:"No orders"}):(0,r.jsx)("div",{className:"space-y-3",children:d.PREPARING.map(e=>(0,r.jsxs)("div",{className:"rounded-lg border border-slate-600 bg-slate-700 p-4",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-semibold text-white",children:["Order #",e.id]}),(0,r.jsxs)("p",{className:"text-xs text-slate-400",children:["Table: ",e.tableName||e.tableId]}),e.createdAt&&(0,r.jsx)("p",{className:"text-xs text-slate-400",children:v(e.createdAt)})]}),e.totalCents&&(0,r.jsx)("p",{className:"text-sm font-medium text-white",children:y(e.totalCents)})]}),(0,r.jsx)("div",{className:"mb-3 space-y-1",children:e.items.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm text-slate-300",children:[(0,r.jsxs)("span",{className:"font-medium",children:[e.qty,"x"]})," ",e.menuItemName||"Item ".concat(e.menuItemId)]},t))}),e.notes&&(0,r.jsxs)("p",{className:"mb-3 text-xs text-yellow-400",children:["Note: ",e.notes]}),(0,r.jsx)("button",{onClick:()=>j(e.id),disabled:p===e.id,className:"w-full rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:p===e.id?"Processing...":"Mark Ready"})]},e.id))})]}),(0,r.jsxs)("section",{className:"rounded-lg bg-slate-800 p-4",children:[(0,r.jsx)("h2",{className:"mb-4 border-b-2 border-yellow-500 pb-2 text-xl font-bold text-white",children:"Ready"}),0===d.PREPARED_WAITING.length?(0,r.jsx)("p",{className:"text-center text-slate-400",children:"No orders"}):(0,r.jsx)("div",{className:"space-y-3",children:d.PREPARED_WAITING.map(e=>(0,r.jsxs)("div",{className:"rounded-lg border border-slate-600 bg-slate-700 p-4",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-semibold text-white",children:["Order #",e.id]}),(0,r.jsxs)("p",{className:"text-xs text-slate-400",children:["Table: ",e.tableName||e.tableId]}),e.createdAt&&(0,r.jsx)("p",{className:"text-xs text-slate-400",children:v(e.createdAt)})]}),e.totalCents&&(0,r.jsx)("p",{className:"text-sm font-medium text-white",children:y(e.totalCents)})]}),(0,r.jsx)("div",{className:"mb-3 space-y-1",children:e.items.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm text-slate-300",children:[(0,r.jsxs)("span",{className:"font-medium",children:[e.qty,"x"]})," ",e.menuItemName||"Item ".concat(e.menuItemId)]},t))}),e.notes&&(0,r.jsxs)("p",{className:"mb-3 text-xs text-yellow-400",children:["Note: ",e.notes]}),(0,r.jsx)("div",{className:"rounded-lg bg-green-500/20 border border-green-500/50 px-3 py-2 text-center text-sm font-medium text-green-300",children:"Ready for Pickup"})]},e.id))})]})]})]})})}},533:function(e,t,s){"use strict";s.d(t,{CT:function(){return a},eg:function(){return i},NA:function(){return l}});var r,n=s(257);let a="http://localhost:8080/api".replace(/\/+$/,"")||(null===(r=n.env.NEXT_PUBLIC_API_URL)||void 0===r?void 0:r.replace(/\/+$/,""))||"http://localhost:8080/api",l=!0,i={ROLE_SUPERADMIN:"/superadmin/dashboard",ROLE_ADMIN:"/admin/dashboard",ROLE_WAITER:"/login",ROLE_KITCHEN:"/login"}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3573)}),_N_E=e.O()}]);