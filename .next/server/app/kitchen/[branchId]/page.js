(()=>{var e={};e.id=797,e.ids=[797],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2203:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),r(1717),r(5651),r(9773),r(4773),r(5866);var s=r(3191),a=r(8716),n=r(7922),l=r.n(n),i=r(5231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let d=["",{children:["kitchen",{children:["[branchId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1717)),"C:\\Users\\ismayila\\platefulmenufront\\src\\app\\kitchen\\[branchId]\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,5651)),"C:\\Users\\ismayila\\platefulmenufront\\src\\app\\kitchen\\[branchId]\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,9773)),"C:\\Users\\ismayila\\platefulmenufront\\src\\app\\kitchen\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,4773)),"C:\\Users\\ismayila\\platefulmenufront\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\ismayila\\platefulmenufront\\src\\app\\kitchen\\[branchId]\\page.tsx"],u="/kitchen/[branchId]/page",h={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/kitchen/[branchId]/page",pathname:"/kitchen/[branchId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},786:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},8667:(e,t,r)=>{Promise.resolve().then(r.bind(r,9395))},5567:(e,t,r)=>{Promise.resolve().then(r.bind(r,1607))},2914:(e,t,r)=>{Promise.resolve().then(r.bind(r,5903))},7798:(e,t,r)=>{Promise.resolve().then(r.bind(r,3567))},1607:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(326),a=r(7577);function n({children:e}){let[t,r]=(0,a.useState)(!1);return t?s.jsx(s.Fragment,{children:e}):null}},5903:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(326),a=r(7577),n=r(5047),l=r(4820);function i(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),r=Number(e.branchId),[i,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)(["","","","","",""]),[u,h]=(0,a.useState)(null),[m,b]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[f,p]=(0,a.useState)(0),v=(0,a.useRef)([]),y=(0,a.useRef)(!1),w=(0,a.useCallback)(e=>{if(!x&&(h(null),d.join("").length<6)){let t=[...d],r=t.findIndex(e=>""===e);-1!==r&&(t[r]=e,c(t),r<5&&p(r+1))}},[d,x]),j=(0,a.useCallback)(()=>{if(x)return;h(null);let e=[...d],t=-1;for(let r=e.length-1;r>=0;r--)if(""!==e[r]){t=r;break}-1!==t&&(e[t]="",c(e),p(t))},[d,x]),N=(0,a.useCallback)((e,t)=>{if(x||(h(null),t.length>1&&(t=t.slice(-1)),""!==t&&!/^\d$/.test(t)))return;let r=[...d];r[e]=t,c(r),t&&e<5&&p(e+1)},[d,x]),P=(0,a.useCallback)((e,t)=>{!x&&("Backspace"===t.key&&""===d[e]&&e>0?p(e-1):"ArrowLeft"===t.key&&e>0?p(e-1):"ArrowRight"===t.key&&e<5&&p(e+1))},[d,x]);(0,a.useCallback)(async e=>{if(6===e.length&&/^\d{6}$/.test(e)){if(isNaN(r)){h("Invalid branch ID");return}if(!y.current&&!m){y.current=!0,b(!0),h(null);try{console.log("[KDS] Verifying PIN for branch:",r);let t=await fetch(`${l.CT}/branches/${r}/kitchen/pin/verify`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({pin:e})});if(!t.ok){let e=await t.json().catch(()=>({}));console.error("[KDS] PIN verification failed:",{status:t.status,statusText:t.statusText,errorData:e}),401===t.status?(h("Invalid PIN. Please try again."),c(["","","","","",""]),p(0)):400===t.status?(h("Invalid PIN format. PIN must be 6 digits."),c(["","","","","",""]),p(0)):404===t.status?h("Branch not found."):h("Failed to verify PIN. Please try again."),b(!1),y.current=!1;return}await t.json(),console.log("[KDS] PIN verified successfully"),g(!0),b(!1),y.current=!1}catch(e){console.error("[KDS] PIN verification error:",e),h("Network error. Please check your connection and try again."),b(!1),y.current=!1}}}},[r,m]);let k=(0,a.useCallback)(()=>{t.push(`/kitchen/${r}/orders`)},[r,t]);if(!i)return null;if(isNaN(r))return s.jsx("main",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 px-4",children:s.jsx("div",{className:"text-center",children:s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Invalid Branch ID"})})});let C=d.join("");return s.jsx("main",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-slate-50 via-white to-slate-50 px-4 py-12",children:(0,s.jsxs)("div",{className:"w-full max-w-lg",children:[(0,s.jsxs)("div",{className:"mb-8 text-center",children:[s.jsx("h1",{className:"mb-2 text-4xl font-extrabold text-gray-900 tracking-tight",children:"Kitchen Display System"}),s.jsx("div",{className:"mx-auto h-1 w-24 rounded-full bg-blue-600"})]}),s.jsx("p",{className:"mb-4 text-center text-lg text-gray-700",children:"Enter 6-digit PIN to access kitchen dashboard."}),(0,s.jsxs)("p",{className:"mb-10 text-center text-base font-medium text-gray-600",children:["Branch # ",s.jsx("span",{className:"font-semibold text-gray-900",children:r})]}),s.jsx("div",{className:"mb-8 flex justify-center gap-4",children:d.map((e,t)=>(0,s.jsxs)("div",{className:"relative",children:[s.jsx("input",{ref:e=>{v.current[t]=e},type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:e=>N(t,e.target.value),onKeyDown:e=>P(t,e),onFocus:()=>p(t),disabled:m||x,className:`h-16 w-16 rounded-xl border-3 text-center text-3xl font-bold text-gray-900 shadow-lg transition-all duration-200 ${x?"border-green-500 bg-green-50":e?"border-blue-400 bg-blue-50 shadow-blue-200":"border-gray-300 bg-white"} ${f!==t||x?"":"border-blue-600 ring-4 ring-blue-200 scale-105"} focus:border-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-200 disabled:opacity-70 disabled:cursor-not-allowed`}),x&&e&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("svg",{className:"h-8 w-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},t))}),x&&s.jsx("div",{className:"mb-6 animate-in fade-in slide-in-from-top-2 duration-300",children:s.jsx("div",{className:"rounded-xl bg-green-50 border-2 border-green-500 p-4 text-center",children:s.jsx("p",{className:"text-lg font-semibold text-green-800",children:"✓ PIN Verified Successfully!"})})}),u&&!x&&s.jsx("div",{className:"mb-6 animate-in fade-in slide-in-from-top-2 duration-300",children:s.jsx("div",{className:"rounded-xl bg-red-50 border-2 border-red-200 p-4 text-center",children:s.jsx("p",{className:"text-sm font-medium text-red-700",children:u})})}),m&&s.jsx("div",{className:"mb-6 text-center",children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-full bg-blue-50 px-4 py-2",children:[(0,s.jsxs)("svg",{className:"h-5 w-5 animate-spin text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Verifying PIN..."})]})}),x&&s.jsx("div",{className:"mb-8 animate-in fade-in slide-in-from-bottom-2 duration-500",children:s.jsx("button",{onClick:k,className:"w-full rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-4 text-lg font-bold text-white shadow-lg transition-all duration-200 hover:from-blue-700 hover:to-blue-800 hover:shadow-xl hover:scale-105 active:scale-100",children:"Continue to Orders"})}),!x&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"mb-4 grid grid-cols-3 gap-3",children:[1,2,3,4,5,6,7,8,9].map(e=>s.jsx("button",{type:"button",onClick:()=>w(e.toString()),disabled:m||C.length>=6,className:"h-16 rounded-xl border-2 border-gray-300 bg-white text-2xl font-bold text-gray-900 shadow-md transition-all duration-150 hover:bg-gray-50 hover:border-gray-400 hover:shadow-lg active:scale-95 disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:bg-white disabled:hover:shadow-md",children:e},e))}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx("button",{type:"button",onClick:()=>w("0"),disabled:m||C.length>=6,className:"h-16 rounded-xl border-2 border-gray-300 bg-white text-2xl font-bold text-gray-900 shadow-md transition-all duration-150 hover:bg-gray-50 hover:border-gray-400 hover:shadow-lg active:scale-95 disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:bg-white disabled:hover:shadow-md",children:"0"}),s.jsx("button",{type:"button",onClick:j,disabled:m||0===C.length,className:"h-16 rounded-xl border-2 border-gray-300 bg-white text-xl font-bold text-gray-900 shadow-md transition-all duration-150 hover:bg-red-50 hover:border-red-300 hover:shadow-lg active:scale-95 disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:bg-white disabled:hover:shadow-md",children:"⌫"})]})]})]})})}},3567:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(326),a=r(7577);function n({children:e}){let[t,r]=(0,a.useState)(!1);return t?s.jsx(s.Fragment,{children:e}):null}},9395:(e,t,r)=>{"use strict";r.d(t,{ConditionalAuthProvider:()=>l});var s=r(326),a=r(5047),n=r(7048);function l({children:e}){let t=(0,a.usePathname)();return t?.startsWith("/kitchen/")?s.jsx(s.Fragment,{children:e}):s.jsx(n.H,{children:e})}},4820:(e,t,r)=>{"use strict";r.d(t,{CT:()=>s,eg:()=>n,NA:()=>a});let s="http://localhost:8080/api".replace(/\/+$/,"")||0,a=!0,n={ROLE_SUPERADMIN:"/superadmin/dashboard",ROLE_ADMIN:"/admin/dashboard",ROLE_WAITER:"/login",ROLE_KITCHEN:"/login"}},7048:(e,t,r)=>{"use strict";r.d(t,{E:()=>c,H:()=>d});var s=r(326),a=r(7577),n=r(5047),l=r(4820);let i=(0,a.createContext)(void 0),o=e=>l.eg[e]??"/admin/dashboard";function d({children:e}){let t=(0,n.useRouter)(),[r,l]=(0,a.useState)(null),[d,c]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),m=(0,a.useCallback)(e=>{if(!e||!e.user||!e.token||"ROLE_WAITER"===e.user.role){l(null),c(null);return}l({...e.user,permissions:Array.isArray(e.user.permissions)?e.user.permissions:[]}),c(e.token)},[]),b=(0,a.useCallback)(async()=>{try{h(!0);let e=await fetch("/api/auth/session",{cache:"no-store"});if(!e.ok)throw Error("Failed to fetch session");let t=await e.json();m(t)}catch(e){console.error("[Auth] session error",e),l(null),c(null)}finally{h(!1)}},[m]),x=(0,a.useCallback)(async e=>{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(403===r.status){let e=await r.json();throw Error(e?.message??"Login restricted for this role")}if(!r.ok){let e=await r.json().catch(()=>void 0);throw Error(e?.message??"Login failed")}let s=await r.json();if(!s.user||!s.token)throw Error("Invalid login response");if("ROLE_WAITER"===s.user.role)throw Error("Login not permitted for this role.");return m(s),t.replace(o(s.user.role)),s.user},[m,t]),g=(0,a.useCallback)(async()=>{await fetch("/api/auth/logout",{method:"POST"}),l(null),c(null),t.replace("/login")},[t]),f=(0,a.useMemo)(()=>({user:r,token:d,loading:u,login:x,logout:g,refreshSession:b}),[r,d,u,x,g,b]);return s.jsx(i.Provider,{value:f,children:e})}let c=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuthContext must be used within AuthProvider");return e}},5651:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`C:\Users\ismayila\platefulmenufront\src\app\kitchen\[branchId]\layout.tsx#default`)},1717:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`C:\Users\ismayila\platefulmenufront\src\app\kitchen\[branchId]\page.tsx#default`)},9773:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`C:\Users\ismayila\platefulmenufront\src\app\kitchen\layout.tsx#default`)},4773:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o,metadata:()=>i});var s=r(9510),a=r(5384),n=r.n(a);r(5023);let l=(0,r(8570).createProxy)(String.raw`C:\Users\ismayila\platefulmenufront\src\components\ConditionalAuthProvider.tsx#ConditionalAuthProvider`),i={title:"PlatefulMenu",description:"Role-based POS management for PlatefulMenu"};function o({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{className:`${n().className} bg-slate-50 text-slate-900`,children:s.jsx(l,{children:e})})})}},5023:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,985],()=>r(2203));module.exports=s})();