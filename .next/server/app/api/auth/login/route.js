"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9370:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>A,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var s={};o.r(s),o.d(s,{POST:()=>k});var n=o(9303),r=o(8716),a=o(670),i=o(7070),c=o(1615),u=o(7848),l=o(5456),p=o(2988);let d={"superadmin@cozycorner.com":{password:"admin123",user:{id:1,email:"superadmin@cozycorner.com",role:"ROLE_SUPERADMIN",restaurantId:1,branchId:null,permissions:[]},token:"mock-token-superadmin-12345"},"admin@downtown.cozycorner.com":{password:"admin123",user:{id:2,email:"admin@downtown.cozycorner.com",role:"ROLE_ADMIN",restaurantId:1,branchId:1,permissions:[]},token:"mock-token-admin-67890"},"kitchen1@cozycorner.com":{password:"kitchen123",user:{id:3,email:"kitchen1@cozycorner.com",role:"ROLE_KITCHEN",restaurantId:1,branchId:1,permissions:[]},token:"mock-token-kitchen-11111"}},m={httpOnly:!0,sameSite:"lax",secure:!0,path:"/"},h=e=>{let t;let o=e?.token??e?.accessToken??e?.jwt??e?.access_token;if(!o)throw console.error("[Auth] No token found in response. Response keys:",Object.keys(e||{})),console.error("[Auth] Response data:",JSON.stringify(e,null,2)),Error("No authentication token found in backend response");try{t=(0,p.a)(o)}catch(e){throw console.error("[Auth] Failed to parse JWT token:",e),Error("Invalid JWT token format")}let s=(0,l.kU)(e?.user,t);if(s||(s=(0,l.kU)(e,t)),s||(s=(0,l.ZP)(t)),!s)throw console.error("[Auth] Unable to build user from response. Response data:",JSON.stringify(e,null,2)),console.error("[Auth] JWT claims:",JSON.stringify(t,null,2)),Error("Unable to extract user information from backend response");return(0,l.cU)(s,t),{token:o,user:s}};async function k(e){let t,o;let s=await e.json();if(u.NA){console.log("[Auth] Mock mode enabled - using mock authentication");let e=d[s.email.toLowerCase()];if(!e||e.password!==s.password)return i.NextResponse.json({message:"Invalid email or password"},{status:401});if("ROLE_WAITER"===e.user.role)return i.NextResponse.json({message:"Login restricted for this role"},{status:403});let t={token:e.token,user:e.user},o=(0,c.cookies)();return o.set("token",t.token||"",m),o.set("role",t.user?.role||"",{...m,httpOnly:!1}),console.log("[Auth] Mock login successful for:",s.email),i.NextResponse.json(t)}let n=`${u.CT}/auth/login`;console.log("[Auth] Attempting login to:",n),console.log("[Auth] Login payload:",{email:s.email,password:"***"});try{t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}catch(e){return console.error("[Auth] Network error connecting to backend:",e),i.NextResponse.json({message:`Cannot connect to backend server at ${n}. Please ensure the backend is running.`},{status:503})}if(console.log("[Auth] Backend response status:",t.status),401===t.status)return console.error("[Auth] Authentication failed (401):",await t.json().catch(()=>({}))),i.NextResponse.json({message:"Invalid email or password"},{status:401});if(!t.ok){let e=await t.json().catch(()=>({}));return console.error("[Auth] Backend error response:",{status:t.status,statusText:t.statusText,body:e}),i.NextResponse.json({message:e?.message??`Login failed: ${t.statusText}`},{status:t.status})}let r=await t.json();console.log("[Auth] Backend response received. Keys:",Object.keys(r||{}));try{o=h(r)}catch(t){console.error("[Auth] Unable to parse login response:",t);let e=t instanceof Error?t.message:"Unexpected login response from backend";return i.NextResponse.json({message:e},{status:500})}if(!o.user||!o.token)return i.NextResponse.json({message:"Unable to determine user role or token"},{status:500});if("ROLE_WAITER"===o.user.role)return i.NextResponse.json({message:"Login restricted for this role"},{status:403});let a=(0,c.cookies)();return a.set("token",o.token,m),a.set("role",o.user.role,{...m,httpOnly:!1}),i.NextResponse.json(o)}let g=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\ismayila\\platefulmenufront\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:y}=g,A="/api/auth/login/route";function w(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),s=t.X(0,[276,972,854],()=>o(9370));module.exports=s})();